<div id="loading">
	<h1>Loading</h1>
</div>


<div class="row" id="question-area">
    <div class="span12">
      <h1>Comment</h1>
      <div id="comment"></div>
      
      <h1>Post</h1>
      <div id="post"></div>
      <table class="taxonomy">
        <tr>
        	<th>Characteristics</th>
        	<th>Target Race</th>
        </tr>

        <tr>
        	<td>
        		<ul>
        			<li>
	        			<label>
							<input type="checkbox" id="Violence">
							Violence
						</label>
					</li>
					<li>
						<label>
							<input type="checkbox" id="Dehumanising">
							Dehumanising
						</label>
					</li>

					<li>
						<label>
							<input type="checkbox" id="Hate">
							Hate
						</label>
					</li>
				</ul>
        	</td>
        	<td>
        		<ul>
        			<li>
	        			<label>
							<input type="checkbox" id="Muslim">
							Muslim
						</label>
					</li>
					<li>
						<label>
							<input type="checkbox" id="Chinese">
							Chinese
						</label>
					</li>

					<li>
						<label>
							<input type="checkbox" id="Buddhist">
							Buddhist
						</label>
					</li>
				</ul>
        	</td>
        </tr>
    </table>

    <h1>Analysis</h1>
      
      <ol class="ctas">

      	<li>
      		<button id="save">Record Incident</button>		
      	</li>

      	<li>
      		<button id="skip">No Incident</button>		
      	</li>
      </ol>
      
    </div>
</div>
<script>

    pybossa.taskLoaded(function(task, deferred){
      

      // don't care if empty task
      deferred.resolve(task)
      
    });
    pybossa.presentTask(function(task, deferred){

		if ( $.isEmptyObject(task) ) {
			alert('All tasks complete');
		}

        console.log('presentTask')


        // show text
        $("#comment").text(task.info["object_link.connections.comments.message"]);
        $("#post").text(task.info["message"]);
        toggleLoading(true)

        activateButtons(task, deferred)
        
        
      
    });
  
  
  function activateButtons(task, deferred) {
    
    $("#save, #skip").off('click').on('click', function(){
      
      console.log('activateButtons')

      var result = {
      	"task_id" : task.id,
      	"info" : task.info,
        "violence" : $("#Violence").is(":checked"),
        "dehumanising" : $("#Dehumanising").is(":checked"),
        "hate" : $("#Hate").is(":checked"),

        "muslim" : $("#Muslim").is(":checked"),
        "chinese" : $("#Chinese").is(":checked"),
        "buddhist" : $("#Buddhist").is(":checked")
      }
      
      toggleLoading(false);

      pybossa.saveTask(task.id, result).done(function() {
          deferred.resolve(task);
      });
      

      resetForm();
    });


    
  }

  function resetForm(){
  	$("table.taxonomy input[type=checkbox]").removeAttr('checked')
  	$("#save").css('visibility', 'hidden')
	$("#skip").css('visibility', 'visible')
  }

  function toggleLoading(showForm) {
  	
  	if (showForm) {
		$("#question-area").show();
		$("#loading").hide();
  	} else {
		$("#question-area").hide();
		$("#loading").show();
  	}

  }
  
  $(function(){
    
    //    $("#question-area").hide();
    $("table.taxonomy input[type=checkbox]").change(function(){

    	// count number that are checked
    	var count = $("table.taxonomy input[type=checkbox]:checked").length;

    	if (count > 0) {
    		$("#save").css('visibility', 'visible')
    		$("#skip").css('visibility', 'hidden')
    	} else {
			$("#save").css('visibility', 'hidden')
			$("#skip").css('visibility', 'visible')
    	}

    })

    resetForm();
    toggleLoading(false)

  });

    pybossa.run('CDNH');
</script>


<style type="text/css">

	#question-area {
		padding:1em;
		background:#eee;
	}
	table.taxonomy {width:100%; margin-top: 2em;}
	table.taxonomy th {text-align: left;}
	table.taxonomy ul {list-style: none; margin:0; padding:0;}
	table.taxonomy ul li {padding:0.5em 0;}

	ol.ctas {
		list-style: none;
		margin-top:2em;
		min-height: 4em;
	}

	ol.ctas li {
		float:left;
		width:50%;
	}

	ol.ctas li button {
		background: #ddd;
		padding:1em;
		border:2px;
		width:40%;
		text-transform: uppercase;
	}
	ol.ctas li button#skip {
		background:lightgreen;
	}
</style>